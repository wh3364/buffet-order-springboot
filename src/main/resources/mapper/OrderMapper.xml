<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fch.buffetorder.mapper.OrderMapper">

    <insert id="createOrder" parameterType="Order" useGeneratedKeys="true" keyColumn="order_id" keyProperty="orderId">
        INSERT
        INTO `order` (user_id, order_way, order_address, order_create_time, order_json_body, order_get_numb,
                      order_state, order_note, order_should_pay, order_real_pay)
        VALUES (#{userId}, #{orderWay}, #{orderAddress}, #{orderCreateTime}, #{orderJsonBody}, #{orderGetNumb},
                #{orderState}, #{orderNote}, #{orderShouldPay}, #{orderRealPay})
    </insert>


    <!--        -->
    <update id="uploadOrderPay" parameterType="Order" useGeneratedKeys="true" keyColumn="user_id" keyProperty="userId">
        UPDATE `order`
        SET order_state    = #{orderState},
            order_real_pay = #{orderRealPay}
        WHERE order_id = #{orderId}
          AND user_id = #{userId}
    </update>

    <!--        -->
    <update id="uploadOrderGoFood" parameterType="Order" useGeneratedKeys="true" keyColumn="user_id" keyProperty="userId">
        UPDATE `order`
        SET order_state    = #{orderState}
        WHERE order_id = #{orderId}
          AND user_id = #{userId}
    </update>


    <select id="queryOrderByOrderIdAndUserId" parameterType="Order" resultType="Order">
        SELECT order_id,
               user_id,
               order_way,
               order_address,
               order_create_time,
               order_json_body,
               order_get_numb,
               order_state,
               order_note,
               order_should_pay,
               order_real_pay
        FROM `order`
        WHERE order_id = #{orderId}
          AND user_id = #{userId}
    </select>

    <select id="queryOrderListById" parameterType="Order" resultType="Order">
        SELECT order_id,
        order_create_time,
        order_json_body,
        order_state,
        order_should_pay
        FROM `order`
        WHERE user_id = #{userId}
        <if test="orderState != null">
            AND order_state = #{orderState}
        </if>
    </select>

    <select id="userQueryOrderListDoingById" parameterType="Order" resultType="Order">
        SELECT order_id,
               order_create_time,
               order_json_body,
               order_state,
               order_should_pay
        FROM `order`
        WHERE user_id = #{userId}
            AND order_state = 0
           OR 1
           OR 2
        ORDER BY order_create_time DESC
    </select>

    <select id="userQueryOrderListCompleteOrCancelById" parameterType="Order" resultType="Order">
        SELECT order_id,
               order_create_time,
               order_json_body,
               order_state,
               order_should_pay
        FROM `order`
        WHERE user_id = #{userId}
          AND order_state = #{orderState}
        ORDER BY order_create_time DESC
    </select>

    <select id="adminQueryOrdersByWayAndState" parameterType="Order" resultType="Order">
        SELECT order_id,
               user_id,
               order_way,
               order_address,
               order_create_time,
               order_json_body,
               order_get_numb,
               order_state,
               order_note,
               order_should_pay,
               order_real_pay
        FROM `order`
        WHERE order_way = #{orderWay}
            AND order_state = 0
           OR 1
           OR 2
        ORDER BY order_create_time DESC
    </select>

</mapper>